<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ESP32 LED Dashboard</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
    body {
        background: #0d0d0d;
        color: white;
        font-family: "Segoe UI", sans-serif;
        display: flex;
        justify-content: center;
        padding: 40px;
    }

    .container {
        background: #1a1a1a;
        width: 420px;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 0 25px rgba(0,0,0,0.5);
        text-align: center;
    }

    h1 {
        font-size: 24px;
        margin-bottom: 15px;
    }

    .color-preview {
        width: 100px;
        height: 100px;
        margin: 15px auto;
        border-radius: 12px;
        border: 2px solid #444;
    }

    .slider-group {
        margin: 15px 0;
        text-align: left;
    }

    input[type="range"] {
        width: 100%;
    }

    .hex-input {
        margin-top: 15px;
        background: #111;
        padding: 12px;
        border-radius: 10px;
    }

    input[type="color"] {
        width: 60px;
        height: 40px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }

    .quick-buttons {
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }

    .quick-buttons button {
        width: 30%;
        height: 40px;
        border: none;
        border-radius: 8px;
        margin-bottom: 10px;
        cursor: pointer;
    }

    .status {
        margin-top: 20px;
        font-size: 14px;
        color: #aaa;
    }
</style>
</head>

<body>
<div class="container">
    <h1>ESP32 LED Controller</h1>
    
    <div class="color-preview" id="preview"></div>

    <!-- Sliders RGB -->
    <div class="slider-group">
        <label>Rojo (R)</label>
        <input type="range" min="0" max="255" value="0" id="rSlider">

        <label>Verde (G)</label>
        <input type="range" min="0" max="255" value="0" id="gSlider">

        <label>Azul (B)</label>
        <input type="range" min="0" max="255" value="0" id="bSlider">
    </div>

    <!-- Selector HEX -->
    <div class="hex-input">
        <label>Selector de color</label><br>
        <input type="color" id="colorPicker">
    </div>

    <!-- Colores rápidos -->
    <div class="quick-buttons">
        <button style="background:red" data-color="#ff0000"></button>
        <button style="background:green" data-color="#00ff00"></button>
        <button style="background:blue" data-color="#0000ff"></button>
        <button style="background:yellow" data-color="#ffff00"></button>
        <button style="background:cyan" data-color="#00ffff"></button>
        <button style="background:magenta" data-color="#ff00ff"></button>
    </div>

    <div class="status" id="status">Conectando a MQTT...</div>
</div>

<script>
    // === MQTT CONNECTION ===
    const client = mqtt.connect("ws://TU_IP_PUBLICA:9001", {
        username: "paulina",
        password: "Jenir263*"
    });

    client.on("connect", () => {
        document.getElementById("status").textContent = "Conectado a MQTT ✓";
    });

    // === UI HANDLERS ===
    const r = document.getElementById("rSlider");
    const g = document.getElementById("gSlider");
    const b = document.getElementById("bSlider");
    const preview = document.getElementById("preview");
    const colorPicker = document.getElementById("colorPicker");

    function updateColor() {
        const rgb = `rgb(${r.value}, ${g.value}, ${b.value})`;
        preview.style.background = rgb;

        const hex = "#" + 
            Number(r.value).toString(16).padStart(2, '0') +
            Number(g.value).toString(16).padStart(2, '0') +
            Number(b.value).toString(16).padStart(2, '0');

        client.publish("esp32/led", hex);
    }

    r.oninput = updateColor;
    g.oninput = updateColor;
    b.oninput = updateColor;

    // Selector de color HEX
    colorPicker.oninput = () => {
        const hex = colorPicker.value;

        // Convertir HEX → RGB
        r.value = parseInt(hex.substring(1,3), 16);
        g.value = parseInt(hex.substring(3,5), 16);
        b.value = parseInt(hex.substring(5,7), 16);

        updateColor();
    };

    // Botones rápidos
    document.querySelectorAll(".quick-buttons button").forEach(btn => {
        btn.onclick = () => {
            const color = btn.dataset.color;
            colorPicker.value = color;

            r.value = parseInt(color.substring(1,3), 16);
            g.value = parseInt(color.substring(3,5), 16);
            b.value = parseInt(color.substring(5,7), 16);

            updateColor();
        };
    });
</script>

</body>
</html>
